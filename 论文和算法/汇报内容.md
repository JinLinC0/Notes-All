使用模型：

![image-20241130134048602](D:\Myproject\develop-study-notes\images\image-20241130134048602.png)

参考论文中的模型在预训练的阶段，将不同模态映射到一个统一的离散空间中，使离散的潜在代码具有相同语义的不同模态之间共享，不同模态间互相学习其他模态的细粒度表征，实现跨模态的对齐

基于这个模型的思路，我将电熔镁炉的数据集进行处理，分为视频模态和电流模态，目的是让电流模态学习视频模态的细粒度表征，提高电流模态的异常检测准确率

一开始，我使用三个模态（电流、视频和文本）进行离散化码本的预训练（论文中提到加入文本模态可以提高码本的性能），但是这种情况后面发现训练的过程中暴露的标签了，因为文本是一段正常工况/异常工况的描述性内容

后续我只使用电流和视频模态进行码本的预训练，在没有暴露标签信息的前提下，进行电流模态学习视频模态的细粒度表征，由于电流模态的噪声比较大，不希望视频模态去学习电流模态的细粒度表征（在原模型中，各个模态是进行等价的学习的），所以说在更新码字的时候，需要进行设置：

![image-20250109182113690](D:\Myproject\develop-study-notes\images\image-20250109182113690.png)

对于`Cross-CPC`模块，根据实际出发点，我们应该只关注四个部分：

- 当前视频模态预测未来电流模态的准确率：`accuracy1`
- 当前视频模态预测未来视频模态的准确率：`accuracy13`
- 当前电流模态预测未来电流模态的准确率：`accuracy4`
- 噪声对比估计损失：`NCE`：通过计算相似度矩阵，用于衡量模型在对比学习任务中的表现

![image-20250109182708204](D:\Myproject\develop-study-notes\images\image-20250109182708204.png)

同时，调整的代码中的部分权重，让模型在训练的时候更加关注电流学习视频模态的表征，抑制视频模态学习电流模态的趋势，训练好的离散化码本用于下游任务进行验证

下游任务：通过视频模态去训练分类头，在使用电流模态进行二分类指标的验证（准确率，精确率，召回率和`F1`分数）（使用的是目前训练好的效果较好的码本进行下游任务）

![image-20250109183954615](D:\Myproject\develop-study-notes\images\image-20250109183954615.png)

一开始，视频模态在训练分类头，可以看到视频模态的指标是在慢慢上升的，在一个`epoch`执行完后，进行一个验证过程，检验电流模态在训练好的异常检测头中的检验指标

经过不断的训练，分类头模型不断的收敛：视频模态和电流模态的指标逐渐收敛

![image-20250109184607792](D:\Myproject\develop-study-notes\images\image-20250109184607792.png)

但是其电流的准确率还是不够高，还需要继续进行优化，后续需要继续找原因，我认为可能有以下几个方面：

- 在验证的时候电流模态的准确率指标往往波动非常大，有时的准确率指标非常差，一平均就导致了整个准确率不高
- 提取电流特征的时候特征没有提取好，导致离散化的时候无法准确的映射到对应的码字（无法正确区分）
- 码字的初始化范围和码字的数量应该需要进行调整（码字数量/范围太大，会导致特征被离散化到不同的码字上；码字的数量/范围太小，无法有效的提取多样化的特征）